define("home:widget/shopping_cart/shopping_cart.js", function (t) { var o = t("common:widget/plugin/dialog/dialog.js"); ({ init: function () { var t = this; t.$sub = $(".subbtn"), t.$add = $(".addbtn"), t.$select = $(".com-select"), t.$delcom = $(".delcom"), t.cartItem = { id: "", num: "" }, t.$dialogConfirm = $(".niu-dialog-confirm"), t.$dialogCancel = $(".niu-dialog-cancel"), t.$niudialog = $(".niu-dialog"), t.$niumask = $(".niu-mask"), t.$dialogclose = $(".niu-dialog-close"), t.$goappy = $("#goappy"), t.m1skus = ["106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "126", "127", "128", "129", "130", "142", "143", "144", "145", "146", "206", "207", "208", "209", "210", "211", "212", "213", "531", "530", "528", "529", "533", "534", "535", "536", "537", "538", "543", "544", "545", "546", "566", "567", "568", "569", "570", "571", "572", "573", "574", "575", "576", "577", "619", "620", "621", "622", "623", "625", "626", "627", "628", "629", "630", "632", "633", "634", "635", "636"], t.coverskus = ["197", "198", "196", "199", "189", "190", "191", "193", "194", "195", "202", "203", "524", "526", "525", "527", "539", "540", "580", "581", "582", "589", "590", "591"], t.m1tocoverskus = { 628: "197", 620: "197", 636: "197", 635: "197", 632: "198", 619: "198", 621: "198", 629: "198", 633: "196", 625: "196", 622: "196", 626: "196", 634: "199", 623: "199", 630: "199", 627: "199" }, t.m1toDoubleCoverskus = { 633: "190", 625: "190", 622: "190", 626: "190", 632: "193", 619: "193", 621: "193", 629: "193", 628: "191", 620: "191", 636: "191", 635: "191", 634: "189", 623: "189", 630: "189", 627: "189" }, t.n1stocoverskus = { 206: "202", 208: "202", 211: "202", 212: "202", 210: "203", 207: "203", 209: "203", 213: "203", 531: "524", 530: "524", 528: "524", 529: "524", 543: "525", 544: "525", 545: "525", 546: "525" }, t.n1stoDoublecoverskus = { 206: "194", 208: "194", 211: "194", 212: "194", 210: "195", 207: "195", 209: "195", 213: "195", 531: "526", 530: "526", 528: "526", 529: "526", 543: "527", 544: "527", 545: "527", 546: "527" }, t.u1tocoverskus = { 566: "580", 567: "581", 568: "581", 569: "581", 570: "580", 571: "582", 572: "580", 573: "580", 574: "582", 575: "582", 576: "582", 577: "581" }, t.u1todoublecoverskus = { 566: "589", 567: "590", 568: "590", 569: "590", 570: "589", 571: "591", 572: "589", 573: "589", 574: "591", 575: "591", 576: "591", 577: "590" }, t.TYPE = t.getQueryString().t || "", console.log("1" == t.TYPE), t.cartId = null, t.event() }, event: function () { var t = this; t.$sub.on("click", function () { var o = $(this), e = t._getInput(o), s = parseInt(e.val()) - 1, a = o.data("id"); return 0 >= s ? !1 : (t.cartItem.num = s, t.cartItem.id = a, t._setCart(), void e.val(s)) }), t.$add.on("click", function () { var o = $(this), e = t._getInput(o), s = parseInt(e.val()) + 1, a = o.data("id"); t.cartItem.num = s, t.cartItem.id = a, t._setCart(), e.val(s) }), t.$select.on("click", function () { var o = $(this), e = o.data("skuid").toString(); -1 != t.m1skus.indexOf(e) ? ($(".com-select-" + t.m1tocoverskus[e]).toggleClass("on"), $(".com-select-" + t.m1toDoubleCoverskus[e]).toggleClass("on"), $(".com-select-" + t.n1stocoverskus[e]).toggleClass("on"), $(".com-select-" + t.n1stoDoublecoverskus[e]).toggleClass("on"), $(".com-select-" + t.u1tocoverskus[e]).toggleClass("on"), $(".com-select-" + t.u1todoublecoverskus[e]).toggleClass("on")) : -1 != t.coverskus.indexOf(e) && ($.each(t.m1tocoverskus, function (t, o) { o == e && $(".com-select-" + t).toggleClass("on") }), $.each(t.m1toDoubleCoverskus, function (t, o) { o == e && $(".com-select-" + t).toggleClass("on") }), $.each(t.n1stocoverskus, function (t, o) { o == e && $(".com-select-" + t).toggleClass("on") }), $.each(t.n1stoDoublecoverskus, function (t, o) { o == e && $(".com-select-" + t).toggleClass("on") }), $.each(t.u1tocoverskus, function (t, o) { o == e && $(".com-select-" + t).toggleClass("on") }), $.each(t.u1todoublecoverskus, function (t, o) { o == e && $(".com-select-" + t).toggleClass("on") })), o.toggleClass("on"); var s = 0; t.$select.each(function (t, o) { $(o).hasClass("on") && (s += +$(o).data("price")) }), $("#comalltotal").html("鍟嗗搧鍚堣锛堜笉鍚繍璐癸級锛�" + s + "鍏�") }), t.$delcom.on("click", function () { var e = $(this).data("skuid").toString(), s = $(this).data("id"); o.confirm({ title: "纭鍒犻櫎璇ュ晢鍝佸悧锛�", content: "鍙兘浼氬け鍘绘湰娆¤喘涔扮殑鏈轰細", leftBtn: "鍙栨秷", rightBtn: "纭畾:!", rightBtnCallback: function () { var o = []; o.push(s), -1 != t.m1skus.indexOf(e) && $(".com-item-" + t.m1tocoverskus[e]).data("id") && o.push($(".com-item-" + t.m1tocoverskus[e]).data("id")), -1 != t.m1skus.indexOf(e) && $(".com-item-" + t.m1toDoubleCoverskus[e]).data("id") && o.push($(".com-item-" + t.m1toDoubleCoverskus[e]).data("id")), -1 != t.m1skus.indexOf(e) && $(".com-item-" + t.n1stocoverskus[e]).data("id") && o.push($(".com-item-" + t.n1stocoverskus[e]).data("id")), -1 != t.m1skus.indexOf(e) && $(".com-item-" + t.n1stoDoublecoverskus[e]).data("id") && o.push($(".com-item-" + t.n1stoDoublecoverskus[e]).data("id")), -1 != t.m1skus.indexOf(e) && $(".com-item-" + t.u1tocoverskus[e]).data("id") && o.push($(".com-item-" + t.u1tocoverskus[e]).data("id")), -1 != t.m1skus.indexOf(e) && $(".com-item-" + t.u1todoublecoverskus[e]).data("id") && o.push($(".com-item-" + t.u1todoublecoverskus[e]).data("id")), t._delCart(o.toString()) } }) }), t.$goappy.on("click", function () { var e = [], s = 0, a = $(".com-select").hasClass("on"), c = new Array(a.length); return t.$select.each(function (t, o) { if ($(o).hasClass("on")) { var a = { sku: $(o).data("skuid"), count: $(o).data("quantity"), depotId: $(o).data("depotid"), ticket: $(o).data("ticket") }; c[s] = a, s++, e.push($(o).data("id")) } }), 0 == e.length ? (o.alert("璇烽€夋嫨鍟嗗搧"), !1) : void $.ajax({ type: "POST", url: "/api/cart/checkCartStock", data: { cartProducts: c }, dataType: "JSON", success: function (s) { "200" == s.status ? window.location.href = "/order/confirm?items=" + t._base64encode(e.toString()) : o.alert(s.message, function () { window.location.reload() }) }, error: function () { } }) }) }, _getInput: function (t) { return t.parent().find(".countinput") }, _setCart: function () { var t = this; $.ajax({ type: "post", url: "/api/cart/setQuantity", data: { itemId: t.cartItem.id, quantity: t.cartItem.num }, dataType: "json", success: function (t) { var e = ""; return t.head && "999999" == t.head.rtnCode ? (G_gologin(), !1) : (t.status && "1" == t.status ? window.location.reload() : e = t.status && "2" == t.status ? "搴撳瓨涓嶈冻" : t.status && "3" == t.status ? "姝ゅ晢鍝侀檺璐�" : "缃戠粶涓嶅紓甯�,璇风◢鍊欏啀璇�", void o.alert(e, function () { window.location.reload() })) }, error: function () { } }) }, _delCart: function (t) { $.ajax({ type: "post", url: "/api/cart/delete", data: { itemId: t }, dataType: "json", success: function (t) { return t.head && "999999" == t.head.rtnCode ? (G_gologin(), !1) : void (t.status && "1" == t.status && window.location.reload()) }, error: function () { } }) }, _base64encode: function (t) { var o, e, s, a, c, n, i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"; for (s = t.length, e = 0, o = ""; s > e;) { if (a = 255 & t.charCodeAt(e++), e == s) { o += i.charAt(a >> 2), o += i.charAt((3 & a) << 4), o += "=="; break } if (c = t.charCodeAt(e++), e == s) { o += i.charAt(a >> 2), o += i.charAt((3 & a) << 4 | (240 & c) >> 4), o += i.charAt((15 & c) << 2), o += "="; break } n = t.charCodeAt(e++), o += i.charAt(a >> 2), o += i.charAt((3 & a) << 4 | (240 & c) >> 4), o += i.charAt((15 & c) << 2 | (192 & n) >> 6), o += i.charAt(63 & n) } return o }, getQueryString: function () { var t = location.search, o = new Object; if (-1 != t.indexOf("?")) { var e = t.substr(1); strs = e.split("&"); for (var s = 0; s < strs.length; s++) o[strs[s].split("=")[0]] = strs[s].split("=")[1] } return o } }).init() });