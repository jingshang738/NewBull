define("hd:widget/hundmil/map.js", function (require, exports, module) { var Utils = {}; Utils.data = function () { var n = {}, t = "http://cms.niu.com/news/index.php?callback=?", a = function (n) { var t = []; for (var a in n) n.hasOwnProperty(a) && t.push(n[a]); return t.join("_") }, i = function (i, e) { $.ajax({ url: t, data: i, timeout: 5e3, type: "get", dataType: "jsonp", success: function (t) { t && 0 !== !+t.status && (n[a(i)] = t.data, e && e(!0)) }, error: function () { } }) }, e = function (t, o, r, p) { o.a = t, o.c = "Api"; var l; (l = n[a(o)]) || p ? r && r(l) : i(o, $.proxy(e, null, t, o, r)) }; return { get: e } }(); var map, zoom = 14; map = new AMap.Map("mapContainer", { resizeEnable: !0, view: new AMap.View2D({ zoom: zoom }) }), map.plugin(["AMap.ToolBar"], function () { var n = new AMap.ToolBar; map.addControl(n) }), map.plugin(["AMap.MapType"], function () { var n = new AMap.MapType({ defaultType: 0, showRoad: !0 }); map.addControl(n) }), map.plugin(["AMap.Scale"], function () { var n = new AMap.Scale; map.addControl(n) }), module.exports = function () { function render(n, t, a) { n.html(itemTpl({ datas: t, disname: a })) } var getData = Utils.data.get, itemTpl = function (obj) { { var __t, __p = ""; Array.prototype.join } with (obj || {}) { __p += '<option value="">' + (null == (__t = disname) ? "" : __t) + "</dt>\n\n"; for (var i = 0; i < datas.length; i++) { var item = datas[i]; __p += '\n\n<option value="' + (null == (__t = item.id) ? "" : __t) + '" data-name="' + (null == (__t = item.name) ? "" : __t) + '">' + (null == (__t = item.name) ? "" : __t) + "</dt>\n\n" } __p += "\n" } return __p }, province = $(".J_pro"), city = $(".J_city"), searchBtn = (require("hd:widget/hundmil/address.js")(), $(".J_search")), leftAdr = $(".J_leftAdr"); province.on("change", function () { var n = $(this).val(); loadCity(n) }); var cityid = 0; city.on("change", function () { var n = $(this).val(); currentCity = $(this).find("option:selected").text(), cityid = n }), searchBtn.click(function () { cityid ? ($(".J_errInfo").addClass("hide"), getData("all_arc", { catid: cityid, type: "zhuanying", c: "Api" }, showInfo)) : ($(".J_errInfo").removeClass("hide"), $(".J_resultInfo").addClass("hide"), $(".J_resultMap").addClass("hide"), $(".J_errInfo").html("请选择店铺地址")) }); var mainItemTpl = function (obj) { { var __t, __p = ""; Array.prototype.join } with (obj || {}) { __p += ""; for (var i = 0; i < data.length; i++) { var item = data[i]; __p += '\n<div class="unit-res unit" data-id="' + (null == (__t = item.id) ? "" : __t) + '">\n    <h3 class="res-title">\n       ' + (null == (__t = item.title) ? "" : __t) + ' \n    </h3>\n    <p class="res-info">\n        地&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;址：' + (null == (__t = item.yingyedizhi) ? "" : __t) + "<br>工&nbsp;作&nbsp;日&nbsp;：周一至周日<br>营业时间：9:30-20:00\n    </p>\n</div>\n" } __p += "\n" } return __p }, infoTpl = function (obj) { { var __t, __p = ""; Array.prototype.join } with (obj || {}) __p += '<div class="map-info-window">\n    <p class="info">' + (null == (__t = item.yingyedizhi) ? "" : __t) + "</p>\n    \n</div>\n"; return __p }, currentCity = "", showInfo = function (n) { var t = n.length; $(".J_resultInfo").removeClass("hide"), $(".J_resultInfo").find(".city").html(currentCity), t > 0 && ($(".J_resultMap").removeClass("hide"), $(".J_resultInfo").find(".num").html(t)), html = mainItemTpl({ data: n }), leftAdr.html(html), map.clearMap(); var a = leftAdr.find(".unit"); $.each(n, function (n, t) { var i = { lng: parseFloat(t.jingdu, 10), lat: parseFloat(t.weidu, 10) }; t.point = i; var e = new AMap.Marker({ icon: "http://webapi.amap.com/images/marker_sprite.png", position: new AMap.LngLat(i.lng, i.lat) }); e.setMap(map); var o = new AMap.InfoWindow({ content: infoTpl({ item: t, idx: n + 1 }), size: new AMap.Size(300, 0), autoMove: !0, offset: new AMap.Pixel(0, -20) }), r = function () { o.open(map, e.getPosition()) }; AMap.event.addListener(e, "click", r), a.eq(n).on("click", function () { $(this).addClass("active").siblings().removeClass("active"), r() }) }), map.setFitView() }; getData("all", { type: "zhuanying", c: "Api" }, function (n) { data_all = n, render(province, data_all, "选择省份") }); var loadCity = function (n) { getData("son", { type: "zhuanying", c: "Api", catid: n }, function (n) { render(city, n, "选择城市") }) } } });